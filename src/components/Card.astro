---
//@ts-nocheck
const url =
  "https://uhcutojnbibslmplbwqd.supabase.co/rest/v1/Portfolio?select=*";
const key =
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVoY3V0b2puYmlic2xtcGxid3FkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc3Mjc5NTcsImV4cCI6MjA2MzMwMzk1N30.gUKjETMs5zvXh4Hhw059erhs-V19eoJSiUCNXidk-V0";

const res = await fetch(url, {
  headers: {
    apikey: key,
    Authorization: `Bearer ${key}`,
  },
});
const rawData = await res.json();

// Group by year
const groupedByYear = rawData.reduce((acc, item) => {
  const year = new Date(item.project_year).getFullYear();
  if (!acc[year]) acc[year] = [];
  acc[year].push(item);
  return acc;
}, {});

// Sort years descending
const sortedYears = Object.keys(groupedByYear).sort((a, b) => b - a);
---

<div class="card-container">
  {
    sortedYears.map((year) => (
      <section class="year-group">
        <h3 class="year-label">{year}</h3>
        {groupedByYear[year].map((item) => (
          <a href={`/portfolio/${item.project_slug}`} class="card-link">
            <article class="card">
              <img src={item.project_photo} alt={item.project_title} />
              <div class="card-text">
                <h2 class="card-title">{item.project_title}</h2>
                <p class="card-subtitle">{item.project_category}</p>
              </div>
            </article>
          </a>
        ))}
      </section>
    ))
  }
</div>

<style>
  .card-container {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }

  .year-label {
    position: relative;
    margin-bottom: 2.5rem;
    color: var(--primary-color);
    padding-bottom: 0.25rem;
  }

  /* Simulated glowing border-bottom */
  .year-label::after {
    content: "";
    position: absolute;
    bottom: 0;
    left: 0;
    height: 2px;
    width: 100%;
    background-color: var(--primary-color);
    box-shadow:
      0 0 6px var(--primary-color),
      0 0 12px var(--primary-color);
  }

  .year-group {
    margin-bottom: 3rem;
  }

  .card {
    background-color: var(--primary-color);
    border-radius: 5px;
    overflow: hidden;
    width: 250px;
    height: 320px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    border: 1.5px solid var(--white-color);
    margin-bottom: 1rem;
  }

  .card img {
    width: 100%;
    height: 200px;
    display: block;
    object-fit: cover;
  }

  .card-text {
    padding: 1rem;
    background-color: var(--primary-color);
  }

  .card-title {
    font-size: 1.5rem;
    margin: 0;
    color: var(--black-color);
    font-weight: 500;
  }

  .card-subtitle {
    font-size: 1.1rem;
    color: var(--black-color);
    font-weight: bold;
    margin-top: 0.25rem;
  }

  .card-link {
    text-decoration: none;
    color: inherit;
    display: block;
  }
</style>
